from IPython.display import display, HTML

# Top 3 drivers
top3 = {
    "Lando Norris": 408,
    "Max Verstappen": 396,
    "Oscar Piastri": 392
}

# Other drivers and points
other_drivers = {
    "George Russell": 309,
    "Charles Leclerc": 230,
    "Lewis Hamilton": 152,
    "Kimi Antonelli": 150,
    "Alexander Albon": 73,
    "Carlos Sainz": 64,
    "Isack Hadjar": 51,
    "Nico Hülkenberg": 49,
    "Fernando Alonso": 48,
    "Oliver Bearman": 41
}

all_drivers = {**top3, **other_drivers}

requiredPoints = {
    "Lando Norris": {"Max Verstappen": 0, "Oscar Piastri": 0},
    "Max Verstappen": {"Lando Norris": 13, "Oscar Piastri": 1},
    "Oscar Piastri": {"Lando Norris": 17, "Max Verstappen": 5}
}

positionsNeeded = {
    "Lando Norris": {"Max Verstappen": 11, "Oscar Piastri": 11},
    "Max Verstappen": {"Lando Norris": 2, "Oscar Piastri": 3},
    "Oscar Piastri": {"Lando Norris": 1, "Max Verstappen": 2},
}

html_code = f"""
<div style="position:relative; min-height:900px; font-family:Arial, sans-serif; color:white; overflow:auto;">
  <!-- Animated racing stripes background -->
  <div style="
        position:absolute;
        top:0; left:0; width:100%; height:100%;
        background: repeating-linear-gradient(
            45deg,
            #ff6600,
            #ff6600 20px,
            #000000 20px,
            #000000 40px
        );
        background-size: 200% 200%;
        animation: stripesMove 10s linear infinite;
        z-index:-1;">
  </div>

  <style>
    @keyframes stripesMove {{
        0% {{ background-position: 0 0; }}
        100% {{ background-position: 100% 100%; }}
    }}
    .racer-card {{
        background:#222; 
        padding:25px; 
        border-radius:12px; 
        width:180px; 
        cursor:pointer; 
        border:2px solid #444; 
        transition:0.3s;
        text-align:center;
        font-weight:bold;
        font-size:16px;
    }}
    .racer-card:hover {{
        transform: scale(1.1);
        box-shadow: 0 0 25px #ffdd00;
        border-color: #ffdd00;
    }}
    /* Podium colors */
    #Lando\\ Norris {{ background: gold; color:black; }}
    #Max\\ Verstappen {{ background: silver; color:black; }}
    #Oscar\\ Piastri {{ background: #cd7f32; color:white; }}
    p:hover {{ color:#ffdd00; cursor:pointer; }}
  </style>

  <div style="text-align:center; padding:20px; position:relative; z-index:1;">
      <h1 style="color:#ffdd00; font-size:36px; text-shadow: 2px 2px 6px black;">Formula 1 – Drivers</h1>

      <!-- Top 3 cards -->
      <div style="display:flex; justify-content:center; gap:25px; margin-top:30px;">
"""
for driver in top3:
    driver_id = driver.replace(" ", "\\ ")
    html_code += f"""<div id="{driver_id}" class="racer-card" onclick="showPoints('{driver}')">{driver}</div>"""
html_code += """
      </div>

      <!-- Other drivers list -->
      <h2 style="margin-top:40px; color:#ff9900; text-shadow: 1px 1px 4px black;">Other Drivers</h2>
      <div style="max-height:350px; overflow-y:auto; margin-top:15px; padding:10px 30px; text-align:left; border-radius:10px; background: rgba(0,0,0,0.5); display:inline-block;">
"""
for driver, pts in other_drivers.items():
    html_code += f"""<p onclick="showPoints('{driver}')">{driver} - {pts} pts</p>"""
html_code += f"""
      </div>

      <!-- Popup -->
      <div id="popup" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#222; padding:25px; border-radius:12px; width:450px; display:none; border:2px solid #ff0000; text-align:left;">
          <h2 id="popupName"></h2>
          <pre id="popupPoints"></pre>
          <button onclick="closePopup()" style="background:#ff0000; border:none; color:white; padding:10px 20px; margin-top:20px; cursor:pointer; border-radius:5px;">Close</button>
      </div>
  </div>
</div>

<script>
    const top3 = {top3};
    const requiredPoints = {requiredPoints};
    const positionsNeeded = {positionsNeeded};
    const allDrivers = {all_drivers};

    function showPoints(driver) {{
        document.getElementById("popupName").textContent = driver;
        const popup = document.getElementById("popupPoints");
        popup.textContent = ""; // clear previous

        let currentPoints = 0;
        const targetPoints = allDrivers[driver];

        // Animate points counting
        const step = Math.max(1, Math.floor(targetPoints / 50));
        const interval = setInterval(() => {{
            currentPoints += step;
            if(currentPoints >= targetPoints) currentPoints = targetPoints;
            popup.textContent = "Current Points: " + currentPoints + "\\n\\nPoints needed to beat top 3 drivers:";
            if(requiredPoints[driver]) {{
                for(const other in requiredPoints[driver]) {{
                    popup.textContent += "\\n- " + other + ": " + requiredPoints[driver][other];
                }}
            }} else {{
                for(const other in top3) {{
                    popup.textContent += "\\n- " + other + ": " + Math.max(0, top3[other] - allDrivers[driver] + 1);
                }}
            }}
            if(positionsNeeded[driver]) {{
                popup.textContent += "\\n\\nTop 3 drivers next race positions needed:";
                for(const other in positionsNeeded[driver]) {{
                    popup.textContent += "\\n- " + other + ": " + positionsNeeded[driver][other] + " or lower";
                }}
            }}
            if(currentPoints >= targetPoints) clearInterval(interval);
        }}, 20);

        document.getElementById("popup").style.display = "block";
    }}

    function closePopup() {{
        document.getElementById("popup").style.display = "none";
    }}
</script>
"""

display(HTML(html_code))
